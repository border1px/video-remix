# 豆包图片下载器 - 浏览器插件

一个功能强大的浏览器插件，用于在豆包等网站上下载生成的图片，支持通过TinyPNG API进行压缩和缩放。

## 功能特性

- ✅ **插件开关控制** - 可以随时启用/禁用插件
- ✅ **自定义保存路径** - 可配置图片保存的目录
- ✅ **网站白名单** - 可配置生效的网站列表（默认：doubao.com）
- ✅ **TinyPNG压缩开关** - 可选择是否启用TinyPNG压缩功能
- ✅ **TinyPNG压缩** - 下载前自动通过TinyPNG API压缩图片
- ✅ **图片缩放** - 支持将图片缩放到指定宽高，保持质量
- ✅ **一键下载** - 每个图片右上角显示下载按钮，点击即可下载
- ✅ **状态显示** - 实时显示总图片数、已处理数、失败数、剩余数
- ✅ **失败重试** - 处理失败的图片可以一键重新处理
- ✅ **结构化代码** - 易于扩展和维护，支持后续添加其他网站

## 安装步骤

1. **准备图标文件**
   - 在 `icons/` 目录下放置以下图标文件：
     - `icon16.png` (16x16像素)
     - `icon48.png` (48x48像素)
     - `icon128.png` (128x128像素)

2. **加载插件到浏览器**
   - 打开 Chrome/Edge 浏览器
   - 访问 `chrome://extensions/` 或 `edge://extensions/`
   - 开启"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择 `plugin-browser` 目录

3. **配置插件**
   - 点击插件图标，打开设置页面
   - 配置以下选项：
     - **TinyPNG API Key**: 在 [TinyPNG开发者页面](https://tinypng.com/developers) 获取
     - **目标宽度/高度**: 设置压缩后的图片尺寸
     - **保存路径**: 设置图片保存的相对路径（相对于浏览器下载目录）
     - **生效网站**: 配置插件生效的网站列表

## 使用方法

1. **启用插件**
   - 点击浏览器工具栏中的插件图标
   - 切换"插件状态"开关为启用

2. **查看处理状态**
   - 在插件弹窗中可以看到处理状态面板
   - 显示总图片数、已处理数、失败数、剩余数
   - 状态每2秒自动刷新

3. **下载图片**
   - 访问豆包网站（或其他配置的网站）
   - 在生成的图片右上角会显示下载按钮
   - 点击下载按钮，图片会自动压缩（如果启用了TinyPNG）并下载到指定目录

4. **重试失败的图片**
   - 如果图片处理失败，会在弹窗的"失败的图片"列表中显示
   - 点击"重试"按钮可以重新处理失败的图片

## 配置说明

### TinyPNG配置

1. **启用/禁用压缩功能**
   - 在设置页面勾选"启用TinyPNG压缩功能"
   - 如果未勾选，图片将直接下载，不进行压缩

2. **获取API Key**
   - 访问 [TinyPNG开发者页面](https://tinypng.com/developers)
   - 注册账号并获取API Key
   - 在插件设置页面输入API Key

### 图片尺寸设置

- **目标宽度/高度**: 设置压缩后图片的最大宽度和高度（像素）
- **保持宽高比**: 勾选后，图片会按比例缩放，不会变形

### 网站配置

在"生效网站列表"中，每行输入一个域名，例如：
```
doubao.com
jimeng.com
*.example.com
```

支持通配符匹配。

## 项目结构

```
plugin-browser/
├── manifest.json          # 插件配置文件
├── popup.html             # 插件弹窗界面
├── popup.js               # 弹窗逻辑
├── popup.css              # 弹窗样式
├── options.html           # 设置页面
├── options.js             # 设置页面逻辑
├── options.css            # 设置页面样式
├── background.js          # Service Worker（后台脚本）
├── content.js             # 内容脚本（注入到网页）
├── content.css            # 内容脚本样式
├── utils/                 # 工具类目录
│   ├── config.js          # 配置管理
│   ├── tinypng.js         # TinyPNG API客户端
│   └── image-downloader.js # 图片下载工具
├── icons/                 # 图标目录
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── README.md              # 本文件
```

## 扩展开发

### 添加新网站支持

1. 在 `content.js` 中的 `ImageDownloadInjector` 类中，修改图片选择器逻辑
2. 或者通过配置"生效网站列表"添加新域名（如果网站结构相同）

### 自定义下载按钮样式

修改 `content.css` 中的 `.doubao-download-btn` 样式类。

### 修改压缩逻辑

编辑 `utils/tinypng.js` 中的 `TinyPNGClient` 类。

## 技术栈

- **Manifest V3** - 最新的Chrome扩展API
- **ES6+ JavaScript** - 现代JavaScript语法
- **TinyPNG API** - 图片压缩和缩放服务
- **Chrome Storage API** - 配置存储
- **Chrome Downloads API** - 文件下载

## 注意事项

1. **TinyPNG API限制**: TinyPNG免费版每月有500次压缩限制，超出后需要付费
2. **跨域问题**: 插件已配置必要的host_permissions，确保可以访问目标网站和TinyPNG API
3. **图片格式**: 支持JPG、PNG、GIF、WebP等常见格式
4. **下载权限**: 首次使用时，浏览器可能会请求下载权限

## 故障排除

### 下载按钮不显示
- 检查插件是否已启用
- 检查当前网站是否在生效网站列表中
- 打开浏览器控制台查看是否有错误信息

### TinyPNG压缩失败
- 检查API Key是否正确
- 检查API使用量是否超限
- 查看浏览器控制台的错误信息

### 图片下载失败
- 检查下载路径是否正确
- 检查浏览器下载权限
- 查看Service Worker控制台的错误信息

## 许可证

MIT License

## 更新日志

### v1.1.0
- 添加状态显示面板（总图片数、已处理数、失败数、剩余数）
- 添加失败图片重试功能
- 添加TinyPNG压缩功能开关配置
- 优化错误处理和状态跟踪
- 修复Manifest V3兼容性问题

### v1.0.0
- 初始版本
- 支持豆包网站图片下载
- 集成TinyPNG压缩和缩放功能
- 可配置网站白名单
- 可配置保存路径

